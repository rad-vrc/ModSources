[2025-08-20 00:00] AiPhone Radial UI 調査ログ

=== 目的 ===
- 左半分でカーソルを動かすと「左〜左上」しか選べない制限の解消
- UIが左上に飛ぶ/位置がズレる現象の恒久対策
- デバッグ情報（F3〜F6）の安定表示

=== 実施したこと（時系列） ===
1) ドット積方式 → 最小角方式 → 直接セクター方式へ移行
   - 目的: 数値安定性の向上
   - 結果: 左半分制限は残存

2) 座標系統一の試み（固定画面中央使用）
   - 内容: anchor.GetDimensions().Center()を使わず、画面中央を基準に
   - 結果: UI位置が左上に移動、選択不可領域が増大 → ロールバック

3) デバッグ無効化の解除
   - 内容: #if DEBUG を排除して F3〜F6 を常時有効化
   - 結果: デバッグ表示は意図通りに復旧

4) InterfaceScaleType を Game に変更
   - 目的: 二重スケーリングの解消
   - 結果: UIが左上に移動、デバッグも不安定 → 失敗。UIへ復旧済み

5) 角度計算の再設計（負角度を完全排除）
   - 内容: Math.Atan2(-v.Y, v.X) → [0,2π)正規化 → +π/2 → 丸め
   - 結果: 右半分で回転方向が逆転する副作用を確認（現状）

=== 失敗/副作用 ===
- InterfaceScaleType.Game: UI位置/当たり判定が一致せず崩壊
- 角度正規化後の+π/2オフセット: 右半分で回転方向が逆転

=== 現在の状況 ===
- UIスケールは InterfaceScaleType.UI で安定中
- 右半分で回転方向が逆転、左半分の選択制限は解消不十分
- F3〜F6 のデバッグはコード上は有効だが、描画順の影響で未表示の可能性

=== 未解決の論点 ===
- 起点と回転方向（ラベル/アイコン配置と角度計算の一致）
- 入力処理タイミング（Update vs Draw）
- 他コンポーネント干渉（InventoryDragPort 等）

=== 次にやるべきこと（目標） ===
1) 角度の回転方向を UI 表示と一致させる
   - 案A: Atan2(v.Y, v.X) を用い、起点を -π/2（上）に揃え、clockwise を確定
   - 案B: Atan2 の結果に符号反転を入れて回転方向を補正（角度→セクターで検証）

2) Debug描画の確実化
   - ModifyInterfaceLayersで Mouse Text より後に挿入し、確実に前面表示
   - F3〜F6 のテキストが常に見えるかを実機で検証

3) 360度テストの自動化（簡易）
   - 8方向に固定したベクトルでセクター算出をログ出力（開発時のみ）
   - 左半分/右半分での結果一致を確認

4) 干渉切り分け
   - InventoryDragPort の PostUpdateInput を一時停止し再検証

=== 成功条件（受け入れ基準） ===
- カーソルがどの位置から開いても 6 セクターが連続して時計回り/反時計回りに選べる
- UI表示位置と当たり判定の中心が 1px 以内で一致
- F3〜F6 デバッグが常時表示され、角度/セクター情報が正しく更新される

=== 備考 ===
- 表示のアイコン配置は IconPos() で「上(-90°)から時計回り」
- 判定も同じ原点/方向に揃えることが重要
